# Story 3.4: Workflow State Management

## Status
**Approved**

## Story

**As a** backend developer,
**I want** service methods that update workflow and task states with proper validation,
**so that** state transitions follow business rules and workflow progresses correctly.

## Acceptance Criteria

1. WorkflowService.updateWorkflowStatus(workflowInstanceId, newStatus, userId, notes) method updates workflow status
2. Valid state transitions are enforced: INITIATED → IN_PROGRESS, IN_PROGRESS → COMPLETED/BLOCKED, BLOCKED → IN_PROGRESS
3. Workflow automatically transitions to IN_PROGRESS when first task is assigned
4. Workflow automatically transitions to COMPLETED when all visible tasks are COMPLETED
5. State change is recorded in workflow_state_history with timestamp and user
6. WorkflowService.updateTaskStatus(taskInstanceId, newStatus, userId) method updates task status
7. Valid task state transitions: NOT_STARTED → IN_PROGRESS, IN_PROGRESS → COMPLETED/BLOCKED, BLOCKED → IN_PROGRESS
8. When task is marked COMPLETED, completed_at and completed_by are recorded
9. When task is marked COMPLETED, system triggers automatic assignment of dependent tasks
10. Method returns updated workflow state summary (tasks completed, tasks in progress, tasks blocked)
11. Unit tests validate state transition rules and automatic workflow progression

## Tasks / Subtasks

- [ ] **Task 1: Add updateWorkflowStatus method to WorkflowService** (AC: 1, 2, 5)
  - [ ] Add method signature: `WorkflowStateSummary updateWorkflowStatus(UUID workflowInstanceId, WorkflowStatus newStatus, UUID userId, String notes)`
  - [ ] Add @Transactional annotation to ensure atomicity
  - [ ] Validate that workflow instance exists (throw ResourceNotFoundException if not found)
  - [ ] Retrieve current workflow instance using WorkflowInstanceRepository
  - [ ] Validate state transition is allowed using helper method: `boolean isValidWorkflowTransition(WorkflowStatus current, WorkflowStatus next)`
  - [ ] Implement transition validation logic: INITIATED→IN_PROGRESS, IN_PROGRESS→COMPLETED/BLOCKED, BLOCKED→IN_PROGRESS
  - [ ] If transition is invalid, throw ValidationException with clear message: "Invalid workflow state transition from {current} to {new}"
  - [ ] Update workflow status and save using WorkflowInstanceRepository
  - [ ] If transitioning to COMPLETED, set completedAt timestamp
  - [ ] Create WorkflowStateHistory record with previousStatus, newStatus, changedBy, changedAt, notes
  - [ ] Save state history using WorkflowStateHistoryRepository
  - [ ] Call getWorkflowStateSummary(workflowInstanceId) and return result
  - [ ] Reference: [Source: docs/architecture/coding-standards.md - Transactional at service layer]

- [ ] **Task 2: Implement automatic workflow transition to IN_PROGRESS** (AC: 3)
  - [ ] Create helper method: `void transitionToInProgressIfNeeded(UUID workflowInstanceId, UUID userId)`
  - [ ] Check if workflow status is INITIATED
  - [ ] If yes, call updateWorkflowStatus(workflowInstanceId, IN_PROGRESS, userId, "First task assigned")
  - [ ] This method will be called by assignTasksForWorkflow() when first task is assigned
  - [ ] Reference: [Source: docs/architecture/data-models.md#WorkflowInstance - Status enum]

- [ ] **Task 3: Implement automatic workflow transition to COMPLETED** (AC: 4)
  - [ ] Create helper method: `void transitionToCompletedIfAllTasksDone(UUID workflowInstanceId, UUID userId)`
  - [ ] Query TaskInstanceRepository to get all tasks for workflow
  - [ ] Filter to visible tasks only (isVisible = true)
  - [ ] Check if ALL visible tasks have status = COMPLETED
  - [ ] If yes, call updateWorkflowStatus(workflowInstanceId, COMPLETED, userId, "All tasks completed")
  - [ ] This method will be called by completeTask() when any task is marked complete
  - [ ] Reference: [Source: docs/architecture/data-models.md#TaskInstance - isVisible field]

- [ ] **Task 4: Add updateTaskStatus method to WorkflowService** (AC: 6, 7, 8)
  - [ ] Add method signature: `TaskStatusUpdate updateTaskStatus(UUID taskInstanceId, TaskStatus newStatus, UUID userId)`
  - [ ] Add @Transactional annotation
  - [ ] Validate that task instance exists (throw ResourceNotFoundException if not found)
  - [ ] Retrieve current task instance using TaskInstanceRepository
  - [ ] Validate state transition is allowed using helper method: `boolean isValidTaskTransition(TaskStatus current, TaskStatus next)`
  - [ ] Implement transition validation logic: NOT_STARTED→IN_PROGRESS, IN_PROGRESS→COMPLETED/BLOCKED, BLOCKED→IN_PROGRESS
  - [ ] If transition is invalid, throw ValidationException with clear message: "Invalid task state transition from {current} to {new}"
  - [ ] Update task status and save using TaskInstanceRepository
  - [ ] If transitioning to COMPLETED, set completedAt and completedBy fields
  - [ ] Return TaskStatusUpdate DTO with updated task details
  - [ ] Reference: [Source: docs/architecture/coding-standards.md - Return DTO not entity]

- [ ] **Task 5: Trigger dependent task assignment when task is completed** (AC: 9)
  - [ ] In updateTaskStatus, after task is marked COMPLETED, check if there are dependent tasks
  - [ ] Call assignTasksForWorkflow(workflowInstanceId) to assign any newly-ready tasks
  - [ ] assignTasksForWorkflow already checks task dependencies and assigns ready tasks
  - [ ] This ensures dependent tasks are automatically assigned when prerequisites complete
  - [ ] Reference: [Source: Story 3.3 - assignTasksForWorkflow method]

- [ ] **Task 6: Implement getWorkflowStateSummary helper method** (AC: 10)
  - [ ] Create method: `WorkflowStateSummary getWorkflowStateSummary(UUID workflowInstanceId)`
  - [ ] Query TaskInstanceRepository for all tasks in workflow
  - [ ] Count tasks by status: tasksCompleted (COMPLETED), tasksInProgress (IN_PROGRESS), tasksBlocked (BLOCKED), tasksNotStarted (NOT_STARTED)
  - [ ] Calculate total visible tasks count
  - [ ] Build WorkflowStateSummary DTO with counts and return
  - [ ] Reference: [Source: docs/architecture/data-models.md#TaskInstance]

- [ ] **Task 7: Create WorkflowStateSummary DTO** (AC: 10)
  - [ ] Create WorkflowStateSummary.java in dto/response/ package
  - [ ] Include fields: UUID workflowInstanceId, WorkflowStatus status, Integer totalTasks, Integer tasksCompleted, Integer tasksInProgress, Integer tasksBlocked, Integer tasksNotStarted
  - [ ] Use @Data annotation for getters/setters
  - [ ] Reference: [Source: docs/architecture/coding-standards.md - ActionEntityResponse pattern]

- [ ] **Task 8: Create TaskStatusUpdate DTO** (AC: 6)
  - [ ] Create TaskStatusUpdate.java in dto/response/ package
  - [ ] Include fields: UUID taskInstanceId, String taskName, TaskStatus status, LocalDateTime completedAt, UUID completedBy
  - [ ] Use @Data annotation for getters/setters
  - [ ] Reference: [Source: docs/architecture/source-tree.md - dto/response/ package]

- [ ] **Task 9: Add custom query method to TaskInstanceRepository** (AC: 4)
  - [ ] Add method: `List<TaskInstance> findByWorkflowInstanceIdAndIsVisible(UUID workflowInstanceId, Boolean isVisible)`
  - [ ] This query retrieves visible tasks for workflow completion check
  - [ ] Add method: `Long countByWorkflowInstanceIdAndStatus(UUID workflowInstanceId, TaskStatus status)`
  - [ ] This query counts tasks by status for state summary
  - [ ] Reference: [Source: docs/architecture/source-tree.md - repository/ package]

- [ ] **Task 10: Write unit tests for updateWorkflowStatus** (AC: 11)
  - [ ] Create WorkflowServiceStateTest.java in test/service/ package
  - [ ] Use @ExtendWith(MockitoExtension.class)
  - [ ] Mock: WorkflowInstanceRepository, TaskInstanceRepository, WorkflowStateHistoryRepository
  - [ ] Test: updateWorkflowStatus_ValidTransition_UpdatesStatusSuccessfully
  - [ ] Test: updateWorkflowStatus_InvalidTransition_ThrowsValidationException
  - [ ] Test: updateWorkflowStatus_InitiatedToInProgress_CreatesStateHistory
  - [ ] Test: updateWorkflowStatus_InProgressToCompleted_SetsCompletedAt
  - [ ] Test: updateWorkflowStatus_WorkflowNotFound_ThrowsResourceNotFoundException
  - [ ] Verify state history record is created with correct fields
  - [ ] Verify WorkflowStateSummary is returned
  - [ ] Reference: [Source: docs/architecture/test-strategy.md - Unit tests with JUnit 5 + Mockito]

- [ ] **Task 11: Write unit tests for updateTaskStatus** (AC: 11)
  - [ ] Create/extend WorkflowServiceStateTest.java in test/service/ package
  - [ ] Test: updateTaskStatus_ValidTransition_UpdatesStatusSuccessfully
  - [ ] Test: updateTaskStatus_InvalidTransition_ThrowsValidationException
  - [ ] Test: updateTaskStatus_InProgressToCompleted_SetsCompletedAtAndCompletedBy
  - [ ] Test: updateTaskStatus_CompletedTask_TriggersAssignmentOfDependentTasks
  - [ ] Test: updateTaskStatus_TaskNotFound_ThrowsResourceNotFoundException
  - [ ] Verify completedAt and completedBy are set when status is COMPLETED
  - [ ] Verify assignTasksForWorkflow is called when task completes
  - [ ] Reference: [Source: docs/architecture/test-strategy.md - Unit tests with JUnit 5 + Mockito]

- [ ] **Task 12: Write unit tests for automatic workflow transitions** (AC: 11)
  - [ ] Create/extend WorkflowServiceStateTest.java in test/service/ package
  - [ ] Test: transitionToInProgressIfNeeded_WhenInitiated_UpdatesStatus
  - [ ] Test: transitionToInProgressIfNeeded_WhenAlreadyInProgress_DoesNothing
  - [ ] Test: transitionToCompletedIfAllTasksDone_AllCompleted_UpdatesStatus
  - [ ] Test: transitionToCompletedIfAllTasksDone_SomeIncomplete_DoesNothing
  - [ ] Test: transitionToCompletedIfAllTasksDone_OnlyCountsVisibleTasks
  - [ ] Verify workflow transitions happen automatically at correct times
  - [ ] Reference: [Source: docs/architecture/test-strategy.md]

- [ ] **Task 13: Write integration test for workflow state management** (AC: 11)
  - [ ] Create WorkflowServiceStateIntegrationTest.java in test/service/ package
  - [ ] Use @SpringBootTest and @Testcontainers with PostgreSQL
  - [ ] Set up test data: workflow instance with multiple tasks in various states
  - [ ] Test full workflow lifecycle: INITIATED → IN_PROGRESS → COMPLETED
  - [ ] Verify state history is recorded at each transition
  - [ ] Verify task completion triggers dependent task assignment
  - [ ] Verify workflow completes when all visible tasks are done
  - [ ] Reference: [Source: docs/architecture/test-strategy.md - TestContainers integration tests]

## Dev Notes

### Previous Story Context
[Source: Story 3.3 Dev Agent Record]

Story 3.3 successfully implemented task assignment and routing logic:
- WorkflowService.assignTasksForWorkflow() method assigns tasks based on role and load balancing
- Tasks transition from NOT_STARTED to IN_PROGRESS when assigned
- Workflow status is updated to IN_PROGRESS when first task is assigned (AC #5 of Story 3.3)
- All operations in single transaction
- 28 unit tests passing

**Key insight for Story 3.4:** Story 3.3 already handles the automatic transition to IN_PROGRESS (AC #3). Story 3.4 formalizes state management methods and adds validation rules.

**Entities available for Story 3.4:**
- WorkflowInstance, TaskInstance, WorkflowStateHistory (from Story 3.1)
- User (from Story 1.x)

**Repositories available for Story 3.4:**
- WorkflowInstanceRepository, TaskInstanceRepository, WorkflowStateHistoryRepository (from Story 3.1)
- UserRepository (from Story 1.x)

### Technology Stack
[Source: docs/architecture/tech-stack.md]

**Backend Framework:**
- Spring Boot 3.2.2
- Java 17 LTS
- Hibernate 6.4.2 (via Spring Data JPA)
- Maven 3.9.6

**Testing:**
- JUnit 5 (5.10.1) for unit tests
- Mockito 5.8.0 for mocking
- TestContainers 1.19.3 for integration tests
- PostgreSQL 17.2 for test database

**Key Dependencies:**
- Lombok 1.18.30 (entities only, per coding standards)
- SLF4J + Logback for logging

### Data Models
[Source: docs/architecture/data-models.md]

**WorkflowInstance Entity:**
- Primary key: UUID id
- Status: Enum (INITIATED, IN_PROGRESS, BLOCKED, COMPLETED)
- Timestamps: initiatedAt, completedAt (nullable)
- Foreign key: initiatedBy (User)
- Audit: createdAt, updatedAt

**TaskInstance Entity:**
- Primary key: UUID id
- Foreign keys: workflowInstanceId (WorkflowInstance), templateTaskId (TemplateTask)
- Assignment: assignedUserId (User, nullable), assignedRole (Enum)
- Status: Enum (NOT_STARTED, IN_PROGRESS, BLOCKED, COMPLETED)
- Visibility: isVisible (Boolean) - controls conditional task display
- Completion: completedAt (LocalDateTime, nullable), completedBy (User, nullable)
- Audit: createdAt, updatedAt

**WorkflowStateHistory Entity:**
- Primary key: UUID id
- Foreign key: workflowInstanceId (WorkflowInstance)
- State tracking: previousStatus, newStatus (WorkflowStatus enums)
- Audit: changedBy (User), changedAt (Timestamp), notes (String)

**Status Enums:**
- WorkflowStatus: INITIATED, IN_PROGRESS, BLOCKED, COMPLETED
- TaskStatus: NOT_STARTED, IN_PROGRESS, BLOCKED, COMPLETED

### Service Layer Patterns
[Source: docs/architecture/coding-standards.md]

**Critical Service Rules:**
1. **Constructor Injection:** All dependencies injected via constructor (immutable, final fields)
2. **@Transactional Annotation:** Place on service methods for transaction management
3. **DTO Usage:** Never expose entities directly, always use DTOs for response
4. **Specific Exceptions:** Throw ValidationException, ResourceNotFoundException (not generic RuntimeException)
5. **Return DTO:** For method returns, use DTOs like WorkflowStateSummary, TaskStatusUpdate
6. **Logger:** Use SLF4J logger: `private static final Logger log = LoggerFactory.getLogger(WorkflowService.class);`

**Naming Conventions:**
- Service class: EntityService (e.g., WorkflowService)
- Method pattern: verbEntity (e.g., updateWorkflowStatus)
- DTOs: ActionEntityResult/Response (e.g., WorkflowStateSummary, TaskStatusUpdate)

**Transaction Management:**
- Use @Transactional at service layer (not controller)
- Spring will auto-rollback on unchecked exceptions
- Multi-step operations (update workflow, create history, check completion) must be in single transaction

### State Transition Validation
[Source: PRD Story 3.4 Requirements]

**Workflow State Transitions (Valid):**
- INITIATED → IN_PROGRESS (first task assigned)
- IN_PROGRESS → COMPLETED (all visible tasks done)
- IN_PROGRESS → BLOCKED (issue encountered)
- BLOCKED → IN_PROGRESS (issue resolved)

**Workflow State Transitions (Invalid):**
- Any direct transition to INITIATED (workflows start as INITIATED, never return)
- INITIATED → COMPLETED (must go through IN_PROGRESS)
- INITIATED → BLOCKED (must go through IN_PROGRESS)
- COMPLETED → any other status (terminal state)

**Task State Transitions (Valid):**
- NOT_STARTED → IN_PROGRESS (task assigned)
- IN_PROGRESS → COMPLETED (task finished)
- IN_PROGRESS → BLOCKED (blocker encountered)
- BLOCKED → IN_PROGRESS (blocker resolved)

**Task State Transitions (Invalid):**
- NOT_STARTED → COMPLETED (must be IN_PROGRESS first)
- NOT_STARTED → BLOCKED (must be IN_PROGRESS first)
- COMPLETED → any other status (terminal state)

**Validation Implementation:**
```java
private boolean isValidWorkflowTransition(WorkflowStatus current, WorkflowStatus next) {
    if (current == WorkflowStatus.COMPLETED) return false; // Terminal state
    if (next == WorkflowStatus.INITIATED) return false; // Can't return to INITIATED

    return switch (current) {
        case INITIATED -> next == WorkflowStatus.IN_PROGRESS;
        case IN_PROGRESS -> next == WorkflowStatus.COMPLETED || next == WorkflowStatus.BLOCKED;
        case BLOCKED -> next == WorkflowStatus.IN_PROGRESS;
        default -> false;
    };
}

private boolean isValidTaskTransition(TaskStatus current, TaskStatus next) {
    if (current == TaskStatus.COMPLETED) return false; // Terminal state

    return switch (current) {
        case NOT_STARTED -> next == TaskStatus.IN_PROGRESS;
        case IN_PROGRESS -> next == TaskStatus.COMPLETED || next == TaskStatus.BLOCKED;
        case BLOCKED -> next == TaskStatus.IN_PROGRESS;
        default -> false;
    };
}
```

### Error Handling
[Source: docs/architecture/error-handling-strategy.md]

**Custom Exceptions to Use:**
- `ResourceNotFoundException` - Workflow or task not found (404)
- `ValidationException` - Invalid state transition (400)

**Error Messages:**
- "Workflow with ID {id} not found"
- "Task with ID {id} not found"
- "Invalid workflow state transition from {current} to {new}"
- "Invalid task state transition from {current} to {new}"

**Logging Standards:**
- Use SLF4J logger: `private static final Logger log = LoggerFactory.getLogger(WorkflowService.class);`
- Log levels:
  - ERROR (exceptions)
  - WARN (unexpected state, invalid transition attempts)
  - INFO (state transitions, workflow completed)
  - DEBUG (state checks, task counts)
- Never log sensitive data (passwords, tokens, PII)

**Service Error Handling:**
- If workflow/task not found: throw ResourceNotFoundException
- If transition invalid: throw ValidationException
- If database error: Spring handles with transaction rollback

### File Locations
[Source: docs/architecture/source-tree.md]

**New Files to Create:**
```
backend/src/
├── main/java/com/magnab/employeelifecycle/
│   ├── dto/
│   │   └── response/
│   │       ├── WorkflowStateSummary.java          # CREATE - Response DTO
│   │       └── TaskStatusUpdate.java              # CREATE - Response DTO
└── test/java/com/magnab/employeelifecycle/
    └── service/
        ├── WorkflowServiceStateTest.java           # CREATE - Unit tests
        └── WorkflowServiceStateIntegrationTest.java # CREATE - Integration tests
```

**Existing Files to Modify:**
- `service/WorkflowService.java` - Add updateWorkflowStatus, updateTaskStatus, helper methods
- `repository/TaskInstanceRepository.java` - Add custom query methods

**Existing Files to Reference (DO NOT MODIFY unless required):**
- Entity classes: WorkflowInstance, TaskInstance, WorkflowStateHistory, User
- Repository interfaces: WorkflowInstanceRepository, TaskInstanceRepository, WorkflowStateHistoryRepository, UserRepository
- Enum classes: WorkflowStatus, TaskStatus
- Exception classes: ResourceNotFoundException, ValidationException

### Automatic State Transitions
[Source: PRD Story 3.4 AC #3, #4]

**Workflow → IN_PROGRESS:**
- **Trigger:** First task is assigned in assignTasksForWorkflow()
- **Condition:** Workflow status is INITIATED
- **Action:** Call transitionToInProgressIfNeeded(workflowInstanceId, userId)
- **Implementation:** Check workflow status, if INITIATED call updateWorkflowStatus with IN_PROGRESS

**Workflow → COMPLETED:**
- **Trigger:** Any task is marked COMPLETED in completeTask() (Story 4.2)
- **Condition:** All visible tasks have status = COMPLETED
- **Action:** Call transitionToCompletedIfAllTasksDone(workflowInstanceId, userId)
- **Implementation:** Query tasks, filter isVisible=true, check all COMPLETED, call updateWorkflowStatus

**Task Assignment Trigger:**
- **Trigger:** Task is marked COMPLETED
- **Condition:** Dependent tasks exist (tasks with dependencyTaskId pointing to this task)
- **Action:** Call assignTasksForWorkflow(workflowInstanceId) to assign newly-ready tasks
- **Implementation:** assignTasksForWorkflow already checks dependencies and assigns ready tasks

### Integration with Other Stories
[Source: PRD Epic 3]

**Story 3.3 (Task Assignment):**
- Story 3.3 calls transitionToInProgressIfNeeded() when first task is assigned
- Story 3.4 provides the state management methods that Story 3.3 uses

**Story 4.2 (Task Completion Service):**
- Story 4.2 will call updateTaskStatus() to mark tasks complete
- Story 4.2 will call transitionToCompletedIfAllTasksDone() after task completion
- Story 3.4 provides the state management foundation for task completion

**Note:** Story 3.3 may have already implemented partial state management for AC #3. Story 3.4 formalizes this with proper validation and full state management methods.

## Testing

### Testing Approach for This Story
[Source: docs/architecture/test-strategy.md]

**Unit Tests (JUnit 5 + Mockito):**
- Test file: `backend/src/test/java/com/magnab/employeelifecycle/service/WorkflowServiceStateTest.java`
- Use @ExtendWith(MockitoExtension.class)
- Mock all repository dependencies with @Mock
- Inject WorkflowService with @InjectMocks
- Coverage goal: 80% for service layer

**Test Scenarios:**
1. Valid workflow state transitions → Status updated, state history created
2. Invalid workflow state transitions → ValidationException thrown
3. Valid task state transitions → Status updated, completedAt/completedBy set
4. Invalid task state transitions → ValidationException thrown
5. Automatic transition to IN_PROGRESS → Workflow status updates when first task assigned
6. Automatic transition to COMPLETED → Workflow status updates when all visible tasks done
7. Hidden tasks excluded → Only visible tasks count toward completion
8. Dependent task assignment → assignTasksForWorkflow called when task completes
9. State history records → Created with correct fields for all transitions
10. Workflow not found → ResourceNotFoundException thrown
11. Task not found → ResourceNotFoundException thrown

**Integration Tests (TestContainers):**
- Test file: `backend/src/test/java/com/magnab/employeelifecycle/service/WorkflowServiceStateIntegrationTest.java`
- Use @SpringBootTest and @Testcontainers
- Real PostgreSQL 17-alpine container
- Verify database state after transitions
- Test complete workflow lifecycle: INITIATED → IN_PROGRESS → COMPLETED
- Verify state history is persisted correctly
- Test task completion triggers dependent task assignment

**Example Unit Test Structure:**
```java
@ExtendWith(MockitoExtension.class)
class WorkflowServiceStateTest {
    @Mock private WorkflowInstanceRepository workflowRepo;
    @Mock private TaskInstanceRepository taskRepo;
    @Mock private WorkflowStateHistoryRepository historyRepo;
    @Mock private UserRepository userRepo;

    @InjectMocks
    private WorkflowService workflowService;

    @Test
    void updateWorkflowStatus_ValidTransition_UpdatesStatusSuccessfully() {
        // Arrange: Mock workflow with INITIATED status
        // Act: Call updateWorkflowStatus(id, IN_PROGRESS, userId, notes)
        // Assert: Verify status updated, state history created, summary returned
    }

    @Test
    void updateWorkflowStatus_InvalidTransition_ThrowsValidationException() {
        // Arrange: Mock workflow with COMPLETED status
        // Act: Call updateWorkflowStatus(id, IN_PROGRESS, userId, notes)
        // Assert: Verify ValidationException thrown with correct message
    }
}
```

**Coverage Verification:**
- Run: `mvn test jacoco:report`
- Check: `target/site/jacoco/index.html`
- Goal: 80% coverage for WorkflowService class

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-31 | 1.1 | Story validated and approved. Comprehensive validation completed: template compliance verified, all 11 ACs covered, anti-hallucination verification passed, implementation readiness confirmed (10/10 score). Status updated from Draft to Approved. | Sarah (Product Owner) |
| 2025-10-31 | 1.0 | Story created from Epic 3 with complete state management specification. Includes workflow and task state transition validation, automatic state transitions (to IN_PROGRESS and COMPLETED), state history recording, and comprehensive unit and integration testing requirements. Builds on Story 3.3 task assignment logic. | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by development agent_

### Debug Log References
_To be populated by development agent_

### Completion Notes
_To be populated by development agent_

### File List
_To be populated by development agent_

## QA Results
_To be populated by QA agent after story completion_
